<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Redisse
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!Redisse.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (R)</a> &raquo;
    
    
    <span class="title">Redisse</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Redisse
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/redisse.rb<span class="defines">,<br />
  lib/redisse/server.rb,<br /> lib/redisse/version.rb,<br /> lib/redisse/publisher.rb,<br /> lib/redisse/server/stats.rb,<br /> lib/redisse/server/redis.rb,<br /> lib/redisse/server/responses.rb,<br /> lib/redisse/redirect_endpoint.rb,<br /> lib/redisse/server_sent_events.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A HTTP API to serve Server-Sent Events via a Redis backend.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Redisse/ServerSentEvents.html" title="Redisse::ServerSentEvents (module)">ServerSentEvents</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Redisse/FromQueryString.html" title="Redisse::FromQueryString (class)">FromQueryString</a></span>, <span class='object_link'><a href="Redisse/RedirectEndpoint.html" title="Redisse::RedirectEndpoint (class)">RedirectEndpoint</a></span>, <span class='object_link'><a href="Redisse/RedisPublisher.html" title="Redisse::RedisPublisher (class)">RedisPublisher</a></span>, <span class='object_link'><a href="Redisse/Server.html" title="Redisse::Server (class)">Server</a></span>, <span class='object_link'><a href="Redisse/TestEvent.html" title="Redisse::TestEvent (class)">TestEvent</a></span>, <span class='object_link'><a href="Redisse/TestPublisher.html" title="Redisse::TestPublisher (class)">TestPublisher</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.3.0</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_port-instance_method" title="#default_port (instance method)">- (Object) <strong>default_port</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The default port of the server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#nginx_internal_url-instance_method" title="#nginx_internal_url (instance method)">- (Object) <strong>nginx_internal_url</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The internal URL hierarchy to redirect to with X-Accel-Redirect.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#redis_server-instance_method" title="#redis_server (instance method)">- (Object) <strong>redis_server</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets/Sets the String URL of the Redis server to connect to.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#channels-instance_method" title="#channels (instance method)">- (Object) <strong>channels</strong>(env) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The list of channels to subscribe to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#middlewares-instance_method" title="#middlewares (instance method)">- (Object) <strong>middlewares</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>List of middlewares defined with <span class='object_link'><a href="#use-instance_method" title="Redisse#use (method)">#use</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#plugin-instance_method" title="#plugin (instance method)">- (Object) <strong>plugin</strong>(name, *args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define a Goliath plugin to run with the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish-instance_method" title="#publish (instance method)">- (Object) <strong>publish</strong>(channel, message) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send an event to subscribers, of the given type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#published-instance_method" title="#published (instance method)">- (Object) <strong>published</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the published events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#redirect_endpoint-instance_method" title="#redirect_endpoint (instance method)">- (Object) <strong>redirect_endpoint</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The Rack application that redirects to <span class='object_link'><a href="#nginx_internal_url-instance_method" title="Redisse#nginx_internal_url (method)">#nginx_internal_url</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Object) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Run the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#test_filter%3D-instance_method" title="#test_filter= (instance method)">- (Object) <strong>test_filter=</strong>(filter) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Filter events stored in test mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#test_mode%21-instance_method" title="#test_mode! (instance method)">- (Object) <strong>test_mode!</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Use test mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use-instance_method" title="#use (instance method)">- (Object) <strong>use</strong>(middleware, *args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define a middleware for the server.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="default_port=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="default_port-instance_method">
  
    - (<tt>Object</tt>) <strong>default_port</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The default port of the server.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_port'>default_port</span>
  <span class='ivar'>@default_port</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="nginx_internal_url=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="nginx_internal_url-instance_method">
  
    - (<tt>Object</tt>) <strong>nginx_internal_url</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The internal URL hierarchy to redirect to with X-Accel-Redirect.</p>

<p>When this property is set, Redisse will work totally differently. Your Ruby
code will not be loaded by the events server itself, but only by the
<span class='object_link'><a href="#redirect_endpoint-instance_method" title="Redisse#redirect_endpoint (method)">#redirect_endpoint</a></span> Rack app that you will have to route to in your Rack
app (e.g. using <code>map</code> in <code>config.ru</code>) and this
endpoint will redirect to this internal URL hierarchy.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nginx_internal_url'>nginx_internal_url</span>
  <span class='ivar'>@nginx_internal_url</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="redis_server=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="redis_server-instance_method">
  
    - (<tt>Object</tt>) <strong>redis_server</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets/Sets the String URL of the Redis server to connect to.</p>

<p>Note that while the Redis pubsub mechanism works outside of the Redis key
namespace and ignores the database (the path part of the URL), the database
will still be used to store an history of the events sent to support
Last-Event-Id.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>Events</span> <span class='op'>&lt;</span> <span class='const'>Redisse</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>
<span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_redis_server'>redis_server</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redis://localhost:6379/42</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_redis_server'>redis_server</span>
  <span class='ivar'>@redis_server</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="channels-instance_method">
  
    - (<tt>Object</tt>) <strong>channels</strong>(env) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The list of channels to subscribe to.</p>

<p>The Redis keys with the same name as the channels will be used to store an
history of the last events sent, in order to support Last-Event-Id.</p>

<p>You need to override this method in your subclass, and depending on the
Rack environment, return a list of channels the current user has access to.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>def</span> <span class='id identifier rubyid_channels'>channels</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='qwords_beg'>%w( </span><span class='tstring_content'>comment</span><span class='words_sep'> </span><span class='tstring_content'>post</span><span class='words_sep'> )</span>
<span class='kw'>end</span>
<span class='comment'># will result in subscriptions to &#39;comment&#39; and &#39;post&#39; channels.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>env</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Rack environment for this request.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>an Array of String naming the channels to subscribe to.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_channels'>channels</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>you must implement </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'>.channels</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="middlewares-instance_method">
  
    - (<tt>Object</tt>) <strong>middlewares</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>List of middlewares defined with <span class='object_link'><a href="#use-instance_method" title="Redisse#use (method)">#use</a></span>.</p>

<p>Used by Goliath to build the server.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_middlewares'>middlewares</span>
  <span class='ivar'>@middlewares</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="plugin-instance_method">
  
    - (<tt>Object</tt>) <strong>plugin</strong>(name, *args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define a Goliath plugin to run with the server.</p>

<p>See <a href="https://github.com/postrank-labs/goliath/wiki/Plugins" target="_parent" title="Goliath plugins">Goliath plugins</a>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plugin'>plugin</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_plugins'>plugins</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish-instance_method">
  
    - (<tt>Object</tt>) <strong>publish</strong>(channel, message) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Send an event to subscribers, of the given type.</p>

<p>All browsers subscribing to the events server will receive a Server-Sent
Event of the chosen type.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='const'>Redisse</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:global</span><span class='comma'>,</span> <span class='label'>notice:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>This is a server-sent event.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='const'>Redisse</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:global</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello, World!</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>
    
      
      <pre class="example code"><code># on the browser side:
var source = new EventSource(eventsURL);
source.addEventListener(&#39;notice&#39;, function(e) {
  console.log(e.data) // logs &#39;This is a server-sent event.&#39;
}, false)
source.addEventListener(&#39;message&#39;, function(e) {
  console.log(e.data) // logs &#39;Hello, World!&#39;
}, false)</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>channel</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The channel to publish the message to.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type_message</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of the event and the content of the message, as a Hash of form {
type =&gt; message } or simply the message as a String, for the default
event type :message.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 57</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_type'>type</span> <span class='op'>||=</span> <span class='symbol'>:message</span>
  <span class='id identifier rubyid_publisher'>publisher</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="published-instance_method">
  
    - (<tt>Object</tt>) <strong>published</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the published events.</p>

<p>Fails unless <span class='object_link'><a href="#test_mode%21-instance_method" title="Redisse#test_mode! (method)">#test_mode!</a></span> is set.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 126</span>

<span class='kw'>def</span> <span class='id identifier rubyid_published'>published</span>
  <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Call </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'>.test_mode! first</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_publisher'>publisher</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:published</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_publisher'>publisher</span><span class='period'>.</span><span class='id identifier rubyid_published'>published</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="redirect_endpoint-instance_method">
  
    - (<tt>Object</tt>) <strong>redirect_endpoint</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The Rack application that redirects to <span class='object_link'><a href="#nginx_internal_url-instance_method" title="Redisse#nginx_internal_url (method)">#nginx_internal_url</a></span>.</p>

<p>If you set <span class='object_link'><a href="#nginx_internal_url-instance_method" title="Redisse#nginx_internal_url (method)">#nginx_internal_url</a></span>, you need to call this Rack application to
redirect to the Redisse server.</p>

<p>Also note that when using the redirect endpoint, two channel names are
reserved, and cannot be used: <code>polling</code> and
<code>lastEventId</code>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code>map &quot;/events&quot; { run Events.redirect_endpoint }</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_endpoint'>redirect_endpoint</span>
  <span class='ivar'>@redirect_endpoint</span> <span class='op'>||=</span> <span class='const'>RedirectEndpoint</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    - (<tt>Object</tt>) <strong>run</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Run the server.</p>

<p>By default, the <span class='object_link'><a href="#channels-instance_method" title="Redisse#channels (method)">#channels</a></span> method is called directly.</p>

<p>If <span class='object_link'><a href="#nginx_internal_url-instance_method" title="Redisse#nginx_internal_url (method)">#nginx_internal_url</a></span> is set, the channels will actually come from the
internal redirect URL generated in the Rack app by <span class='object_link'><a href="#redirect_endpoint-instance_method" title="Redisse#redirect_endpoint (method)">#redirect_endpoint</a></span>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse/server.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>
  <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'>Server</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_api'>api</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_runner'>runner</span> <span class='op'>=</span> <span class='const'>Goliath</span><span class='op'>::</span><span class='const'>Runner</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>ARGV</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_app'>app</span> <span class='op'>=</span> <span class='const'>Goliath</span><span class='op'>::</span><span class='const'>Rack</span><span class='op'>::</span><span class='const'>Builder</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_load_plugins'>load_plugins</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>Stats</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_plugins'>plugins</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_runner'>runner</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="test_filter=-instance_method">
  
    - (<tt>Object</tt>) <strong>test_filter=</strong>(filter) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Filter events stored in test mode.</p>

<p>If set, only events whose type match with the filter are stored in
<span class='object_link'><a href="#published-instance_method" title="Redisse#published (method)">#published</a></span>. A filter matches by using case equality, which allows using a
simple Symbol or a Proc for more advanced filters:</p>

<p>Automatically sets <span class='object_link'><a href="#test_mode%21-instance_method" title="Redisse#test_mode! (method)">#test_mode!</a></span>, so it also clears the previous events.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_test_filter'>test_filter</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span> <span class='id identifier rubyid_type'>type</span> <span class='tlambeg'>{</span> <span class='qsymbols_beg'>%i(</span><span class='tstring_content'>foo</span><span class='words_sep'> </span><span class='tstring_content'>baz</span><span class='words_sep'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_type'>type</span> <span class='rbrace'>}</span>
<span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span> <span class='symbol'>:global</span><span class='comma'>,</span> <span class='label'>foo:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stored</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span> <span class='symbol'>:global</span><span class='comma'>,</span> <span class='label'>bar:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>skipped</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span> <span class='symbol'>:global</span><span class='comma'>,</span> <span class='label'>baz:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stored</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_published'>published</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='comment'># =&gt; 2</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 118</span>

<span class='kw'>def</span> <span class='id identifier rubyid_test_filter='>test_filter=</span><span class='lparen'>(</span><span class='id identifier rubyid_filter'>filter</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_test_mode!'>test_mode!</span>
  <span class='id identifier rubyid_publisher'>publisher</span><span class='period'>.</span><span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> <span class='id identifier rubyid_filter'>filter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="test_mode!-instance_method">
  
    - (<tt>Object</tt>) <strong>test_mode!</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Use test mode.</p>

<p>Instead of actually publishing to Redis, events will be stored in
<span class='object_link'><a href="#published-instance_method" title="Redisse#published (method)">#published</a></span> to use for tests.</p>

<p>Must be called before each test in order for published events to be
emptied.</p>

<p>See also <span class='object_link'><a href="#test_filter%3D-instance_method" title="Redisse#test_filter= (method)">#test_filter=</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='comment'># RSpec
</span><span class='id identifier rubyid_before'>before</span> <span class='lbrace'>{</span> <span class='const'>Events</span><span class='period'>.</span><span class='id identifier rubyid_test_mode!'>test_mode!</span> <span class='rbrace'>}</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 99</span>

<span class='kw'>def</span> <span class='id identifier rubyid_test_mode!'>test_mode!</span>
  <span class='ivar'>@publisher</span> <span class='op'>=</span> <span class='const'>TestPublisher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use-instance_method">
  
    - (<tt>Object</tt>) <strong>use</strong>(middleware, *args, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define a middleware for the server.</p>

<p>See <a href="https://github.com/postrank-labs/goliath/wiki/Middleware" target="_parent" title="Goliath middlewares">Goliath middlewares</a>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>module</span> <span class='const'>Events</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'>Redisse</span>
  <span class='id identifier rubyid_use'>use</span> <span class='const'>MyMiddleware</span><span class='comma'>,</span> <span class='label'>foo:</span> <span class='kw'>true</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/redisse.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='id identifier rubyid_middleware'>middleware</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_middlewares'>middlewares</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_middleware'>middleware</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Jun 19 00:47:41 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.2).
</div>

  </body>
</html>